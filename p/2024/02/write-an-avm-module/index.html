<!doctype html><html lang=en dir=ltr><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="This is a post about writing your first Azure Verified Modules, for those interested in the background about AVM, check out this recent intro on YouTube.
This is recommended as a learning exercise to familiarise yourself with AVM. I strongly encourage contributing to the official resource modules Microsoft is in the process of building.
We&amp;rsquo;re going to focus on writing a resource module:
It is recommended to use a unix-based system for writing AVM modules (e."><title>How to write your first AVM resource module</title>
<link rel=canonical href=https://blog.kewalaka.nz/p/2024/02/write-an-avm-module/><link rel=stylesheet href=/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css><meta property="og:title" content="How to write your first AVM resource module"><meta property="og:description" content="This is a post about writing your first Azure Verified Modules, for those interested in the background about AVM, check out this recent intro on YouTube.
This is recommended as a learning exercise to familiarise yourself with AVM. I strongly encourage contributing to the official resource modules Microsoft is in the process of building.
We&amp;rsquo;re going to focus on writing a resource module:
It is recommended to use a unix-based system for writing AVM modules (e."><meta property="og:url" content="https://blog.kewalaka.nz/p/2024/02/write-an-avm-module/"><meta property="og:site_name" content="The blog of Kewalaka"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="terraform"><meta property="article:tag" content="avm"><meta property="article:published_time" content="2024-02-01T19:08:03+13:00"><meta property="article:modified_time" content="2024-02-01T19:08:03+13:00"><meta property="og:image" content="https://blog.kewalaka.nz/p/2024/02/write-an-avm-module/Azure-Verified-Modules-2783756541.png"><meta name=twitter:title content="How to write your first AVM resource module"><meta name=twitter:description content="This is a post about writing your first Azure Verified Modules, for those interested in the background about AVM, check out this recent intro on YouTube.
This is recommended as a learning exercise to familiarise yourself with AVM. I strongly encourage contributing to the official resource modules Microsoft is in the process of building.
We&amp;rsquo;re going to focus on writing a resource module:
It is recommended to use a unix-based system for writing AVM modules (e."><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.kewalaka.nz/p/2024/02/write-an-avm-module/Azure-Verified-Modules-2783756541.png"></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/static/img/profile.png width=300 height=300 class=site-logo loading=lazy alt=Avatar></a></figure><div class=site-meta><h1 class=site-name><a href=/>The blog of Kewalaka</a></h1><h2 class=site-description>A hodgepodge of technical bits.</h2></div></header><ol class=social-menu><li><a href=https://github.com/kewalaka target=_blank title=GitHub rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://www.linkedin.com/in/stumace target=_blank title=LinkedIn rel=me><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><div class=menu-bottom-section><li id=dark-mode-toggle><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></div></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#check-for-an-existing-module>Check for an existing module</a></li><li><a href=#avm-module-naming>AVM Module naming</a></li><li><a href=#raise-a-module-proposal>Raise a module proposal</a></li><li><a href=#a-practical-example>A practical example</a></li><li><a href=#use-the-avm-template>Use the AVM template</a></li><li><a href=#github-settings>GitHub settings</a></li><li><a href=#clone--feature-branch>Clone & feature branch</a></li><li><a href=#install-the-newres-command-line-utility>Install the &ldquo;newres&rdquo; command line utility</a><ol><li><a href=#newres-updates-for-maintf>newres updates for main.tf</a></li><li><a href=#update-the-identity-block-in-maintf>Update the identity block in main.tf</a></li><li><a href=#newres-updates-for-variablestf>newres updates for variables.tf</a></li><li><a href=#newres-tidy-up>newres tidy-up</a></li></ol></li><li><a href=#todo-hunting>TODO hunting</a><ol><li><a href=#maintf>main.tf</a></li><li><a href=#localstelemetrytf>locals.telemetry.tf</a></li><li><a href=#mainprivateendpointtf>main.privateendpoint.tf</a></li><li><a href=#localstf>locals.tf</a></li><li><a href=#terraformtf>terraform.tf</a></li><li><a href=#variablestf>variables.tf</a></li><li><a href=#outputstf>outputs.tf</a></li><li><a href=#_headermd>_header.md</a></li></ol></li><li><a href=#creating-the-default-example>Creating the default example</a><ol><li><a href=#update-the-default-example>Update the default example</a></li></ol></li><li><a href=#updating-docs-and-running-pr-checks>Updating docs and running PR checks</a></li><li><a href=#github-runners>GitHub runners</a></li><li><a href=#raise-a-pr>Raise a PR</a><ol><li><a href=#find-this-on-github>Find this on Github</a></li></ol></li><li><a href=#where-next>Where next</a><ol><li><a href=#add-child-resources>Add child resources</a></li><li><a href=#add-more-examples-end-to-end-tests>Add more examples (end to end tests)</a></li></ol></li><li><a href=#where-to-look-for-inspiration>Where to look for inspiration</a></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/2024/02/write-an-avm-module/><img src=/p/2024/02/write-an-avm-module/Azure-Verified-Modules-2783756541_hu569cbc7674f36d790c33c17d87477a75_58340_800x0_resize_box_3.png srcset="/p/2024/02/write-an-avm-module/Azure-Verified-Modules-2783756541_hu569cbc7674f36d790c33c17d87477a75_58340_800x0_resize_box_3.png 800w, /p/2024/02/write-an-avm-module/Azure-Verified-Modules-2783756541_hu569cbc7674f36d790c33c17d87477a75_58340_1600x0_resize_box_3.png 1600w" width=800 height=246 loading=lazy alt="Featured image of post How to write your first AVM resource module"></a></div><div class=article-details><header class=article-category><a href=/categories/iac/>iac</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/2024/02/write-an-avm-module/>How to write your first AVM resource module</a></h2></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>01 Feb, 2024</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>13 minute read</time></div></footer></div></header><section class=article-content><p>This is a post about writing your first <a class=link href=https://aka.ms/AVM target=_blank rel=noopener>Azure Verified Modules</a>, for those interested in the background about AVM, check out this recent <a class=link href="https://www.youtube.com/watch?v=JbIMrJKW5N0" target=_blank rel=noopener>intro on YouTube</a>.</p><p>This is recommended as a learning exercise to familiarise yourself with AVM. I strongly encourage contributing to the official resource modules Microsoft is in the process of building.</p><p>We&rsquo;re going to focus on writing a resource module:</p><p><img src=/p/2024/02/write-an-avm-module/avm-resources-and-patterns.png width=701 height=587 srcset="/p/2024/02/write-an-avm-module/avm-resources-and-patterns_hua3d7c87c48fb66b48e3aa1ad50c8bcb3_68275_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/avm-resources-and-patterns_hua3d7c87c48fb66b48e3aa1ad50c8bcb3_68275_1024x0_resize_box_3.png 1024w" loading=lazy alt="illustration of AVM resources and patterns" class=gallery-image data-flex-grow=119 data-flex-basis=286px></p><p>It is recommended to use a unix-based system for writing AVM modules (e.g. either WSL2, a Mac, a Linux variant, or GitHub codespaces).</p><p>I assume a familiarity with git, including how to clone and create feature branches.</p><p>The process is going to be:</p><ul><li>Check if the AVM module already exists & understand resource module naming conventions.</li><li>Create a new GitHub repo for the module from the AVM template.</li><li>Update the GitHub repo to enable support for running &rsquo;end to end&rsquo; tests in GitHub actions.</li><li>Build the resource module, using the newres tool.</li></ul><p>Let&rsquo;s get started!</p><h2 id=check-for-an-existing-module>Check for an existing module</h2><p>If a module already exists, we should use or contribute to the existing one. They are all listed on the <a class=link href=https://azure.github.io/Azure-Verified-Modules/indexes/terraform/tf-resource-modules/ target=_blank rel=noopener>AVM website</a>.</p><p>Bear in mind that many resources are not available yet, as this initiative is new. We&rsquo;re going to pick &ldquo;Dev Center&rdquo; for this example, as it doesn&rsquo;t yet exist in AVM for Terraform.</p><h2 id=avm-module-naming>AVM Module naming</h2><p>If you can&rsquo;t find the resource, lets make one! We&rsquo;ll start by understanding the module naming conventions.</p><p>AVM modules are named as <a class=link href=https://azure.github.io/Azure-Verified-Modules/specs/shared/#terraform-resource-module-naming target=_blank rel=noopener>per the spec</a>, to summarise it should look something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>avm-res-&lt;resource provider&gt;-&lt;ARM resource type&gt;
</span></span></code></pre></td></tr></table></div></div><ul><li>The resource provider should not include the &ldquo;Microsoft.&rdquo; part.</li><li>The resource type should be in singular form.</li></ul><p>Here are some examples to help:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>avm-res-containerregistry-registry
</span></span><span class=line><span class=cl>avm-res-storage-storageaccount
</span></span><span class=line><span class=cl>avm-res-keyvault-vault
</span></span></code></pre></td></tr></table></div></div><p>The GitHub repo name is prefixed with <code>terraform-azurerm-</code> to allow it to be published correctly in the Hashicorp public registry.</p><p>So, for example, the KeyVault GitHub repository would be:</p><p><a class=link href=https://github.com/Azure/terraform-azurerm-avm-res-keyvault-vault target=_blank rel=noopener>https://github.com/Azure/terraform-azurerm-avm-res-keyvault-vault</a></p><h2 id=raise-a-module-proposal>Raise a module proposal</h2><p>If you&rsquo;re planning to contribute back (I strongly encourage it!), it is a good idea to raise an issue, this will help validate the module naming & scope and start the process to find a Microsoft FTE to support the module.</p><p>You can raise a module proposal using this issue template: <a class=link href=https://aka.ms/AVM/ModuleProposal target=_blank rel=noopener>https://aka.ms/AVM/ModuleProposal</a>.</p><h2 id=a-practical-example>A practical example</h2><p>Lets get started making the Dev Centre resource module in Terraform, this is co-incidentally something I need as a pre-requisite to building a <a class=link href=https://azure.microsoft.com/en-us/products/dev-box/ target=_blank rel=noopener>Dev Box</a> in Azure.</p><p>It&rsquo;s <em>a very simple example</em> with a limited number of inputs, a good place to start!</p><p>We&rsquo;ll check the Hashicorp documentation to make sure there is support for it in the AzureRM Terraform provider, and here it is:</p><p><a class=link href=https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dev_center target=_blank rel=noopener>https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dev_center</a></p><p>Remember, if AzureRM isn&rsquo;t available, there&rsquo;s always AzAPI, but that is for another day.</p><p>You may need to register &ldquo;Microsoft.DevCenter&rdquo; in your subscription resource providers if you are following along:</p><p><img src=/p/2024/02/write-an-avm-module/resource-provider.png width=922 height=251 srcset="/p/2024/02/write-an-avm-module/resource-provider_hu475af72d10002e73d3e27ff3ae33a613_12335_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/resource-provider_hu475af72d10002e73d3e27ff3ae33a613_12335_1024x0_resize_box_3.png 1024w" loading=lazy alt="illustrating the registered Microsoft.DevCenter resource provider" class=gallery-image data-flex-grow=367 data-flex-basis=881px></p><h2 id=use-the-avm-template>Use the AVM template</h2><p>There is a an <a class=link href=https://github.com/Azure/terraform-azurerm-avm-template target=_blank rel=noopener>AVM module template repository</a> to help get you started.</p><p><img src=/p/2024/02/write-an-avm-module/create-a-new-repo-from-template.png width=799 height=130 srcset="/p/2024/02/write-an-avm-module/create-a-new-repo-from-template_hu6c3a0a54fe0212324584e11667e84e81_11787_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/create-a-new-repo-from-template_hu6c3a0a54fe0212324584e11667e84e81_11787_1024x0_resize_box_3.png 1024w" loading=lazy alt="Select &ldquo;Use this template&rdquo; -> &ldquo;Create a new repository&rdquo;" class=gallery-image data-flex-grow=614 data-flex-basis=1475px></p><p>The repo name will be <code>terraform-azurerm-avm-res-devcenter-devcenter</code>:</p><p><img src=/p/2024/02/write-an-avm-module/name-the-github-repo.png width=739 height=441 srcset="/p/2024/02/write-an-avm-module/name-the-github-repo_hu08d8ead4a9b41c313226910af09e5fea_19465_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/name-the-github-repo_hu08d8ead4a9b41c313226910af09e5fea_19465_1024x0_resize_box_3.png 1024w" loading=lazy alt="name the repository" class=gallery-image data-flex-grow=167 data-flex-basis=402px></p><h2 id=github-settings>GitHub settings</h2><p>(TODO link to another guide with more detail for peeps that need it)</p><p>Within your cloned repo on Github, do the following:</p><ol><li>Set up a GitHub repo environment called <code>test</code>.</li><li>Configure environment protection rule to ensure that approval is required before deploying to this environment.</li><li>Create a user-assigned managed identity in your test subscription.</li><li>Create a role assignment for the managed identity on your test subscription, recommend providing this &ldquo;Contributor&rdquo; and &ldquo;Role Based Access Control Administrator&rdquo;.</li><li>Configure federated identity credentials on the user assigned managed identity. Use the GitHub environment.</li><li>Set the following secrets on your GitHub environment:<ol><li><code>AZURE_TENANT_ID</code></li><li><code>AZURE_SUBSCRIPTION_ID</code> - i.e. the subscription you will be using to deploy resources to test the module.</li><li><code>AZURE_CLIENT_ID</code> - i.e. the client id of the managed identity.</li></ol></li></ol><h2 id=clone--feature-branch>Clone & feature branch</h2><p>Clone down the repository and open it in your preferred editor (I use Visual Studio Code).</p><p>Create a new feature branch for the initial version updates.</p><h2 id=install-the-newres-command-line-utility>Install the &ldquo;newres&rdquo; command line utility</h2><p>You can skip this step if you&rsquo;re using the AVM template&rsquo;s Codespace, as it is already installed.</p><p><a class=link href=https://github.com/lonegunmanb/newres/ target=_blank rel=noopener>newres</a> will usually greatly speed up writing the resource module where there are a lot of parameters. In this example, there are only a few and isn&rsquo;t really worth it, but we&rsquo;ll continue so you see the method.</p><p>If you repeat this process with something with lots of parameters, like App Gateway, you&rsquo;ll quickly see the benefit!</p><p>Assuming you already have <a class=link href=https://go.dev/doc/install target=_blank rel=noopener>golang installed</a>, run:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>go install github.com/lonegunmanb/newres/v3@latest
</span></span></code></pre></td></tr></table></div></div><p>Run the following to make a temporary folder for newres output and run the tool:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>mkdir newres
</span></span><span class=line><span class=cl><span class=nb>cd</span> newres
</span></span><span class=line><span class=cl>newres -dir ./ -r azurerm_dev_center
</span></span></code></pre></td></tr></table></div></div><p>If successful, you&rsquo;ll see:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>Successfully generated variables.tf and main.tf
</span></span></code></pre></td></tr></table></div></div><p>The newres naming convention needs an adjustment for AVM, in the generated main.tf, observe the variables all start <strong>dev_centre_</strong> - we need to remove this prefix, leaving you with this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;azurerm_dev_center&#34;</span> <span class=s2>&#34;this&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>location</span>            = <span class=nb>var</span><span class=p>.</span><span class=nx>location</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>                = <span class=nb>var</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=cl>  <span class=na>resource_group_name</span> = <span class=nb>var</span><span class=p>.</span><span class=nx>resource_group_name</span>
</span></span><span class=line><span class=cl>  <span class=na>tags</span>                = <span class=nb>var</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>dynamic</span> <span class=s2>&#34;identity&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>for_each</span> = <span class=nb>var</span><span class=p>.</span><span class=na>identity</span> =<span class=o>=</span> <span class=nx>null</span> <span class=o>?</span> <span class=p>[]</span> <span class=o>:</span> <span class=p>[</span><span class=nb>var</span><span class=p>.</span><span class=nx>identity</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>type</span>         = <span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>type</span>
</span></span><span class=line><span class=cl>      <span class=na>identity_ids</span> = <span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>identity_ids</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nx>dynamic</span> <span class=s2>&#34;timeouts&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>for_each</span> = <span class=nb>var</span><span class=p>.</span><span class=na>timeouts</span> =<span class=o>=</span> <span class=nx>null</span> <span class=o>?</span> <span class=p>[]</span> <span class=o>:</span> <span class=p>[</span><span class=nb>var</span><span class=p>.</span><span class=nx>timeouts</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>create</span> = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>create</span>
</span></span><span class=line><span class=cl>      <span class=na>delete</span> = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>delete</span>
</span></span><span class=line><span class=cl>      <span class=na>read</span>   = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>read</span>
</span></span><span class=line><span class=cl>      <span class=na>update</span> = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>update</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>This will also need to be fixed in the variables.tf file.</p><h3 id=newres-updates-for-maintf>newres updates for main.tf</h3><p>Copy the contents of newres\main.tf into main.tf, replacing this block:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;azurerm_TODO_the_resource_for_this_module&#34;</span> <span class=s2>&#34;this&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>Remove the TODO from the top of the file & update the location as follows:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl>  <span class=na>location</span>            =<span class=nb> coalesce</span><span class=p>(</span><span class=nb>var</span><span class=p>.</span><span class=nx>location</span><span class=p>,</span> <span class=nx>local</span><span class=p>.</span><span class=nx>resource_group_location</span><span class=p>)</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=update-the-identity-block-in-maintf>Update the identity block in main.tf</h3><p>Update the dynamic &ldquo;identity&rdquo; block (assuming it exists), following the reference examples in the <a class=link href=https://azure.github.io/Azure-Verified-Modules/specs/shared/interfaces/#managed-identities target=_blank rel=noopener>AVM interface specification for managed identities</a>:</p><p><img src=/p/2024/02/write-an-avm-module/managed-identity-interface.png width=992 height=496 srcset="/p/2024/02/write-an-avm-module/managed-identity-interface_hu024631102f9acf168ac68eee1d5c4e6e_44336_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/managed-identity-interface_hu024631102f9acf168ac68eee1d5c4e6e_44336_1024x0_resize_box_3.png 1024w" loading=lazy alt="managed identity implementation - for resources supporting both a SystemAssigned & UserAssigned id" class=gallery-image data-flex-grow=200 data-flex-basis=480px></p><p>Make sure to check the Hashicorp documentation to confirm the identities supported by the resource (SystemAssigned, UserAssigned, or both).</p><p>The <a class=link href=https://registry.terraform.io/providers/hashicorp/azurerm/latest/docs/resources/dev_center#identity-block target=_blank rel=noopener>identity block for the Dev Center resource</a> shows that both types of identities are supported.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span><span class=lnt>7
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl>  <span class=nx>dynamic</span> <span class=s2>&#34;identity&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>for_each</span> = <span class=p>(</span><span class=nb>var</span><span class=p>.</span><span class=nx>managed_identities</span><span class=p>.</span><span class=nx>system_assigned</span> <span class=o>||</span><span class=nb> length</span><span class=p>(</span><span class=nb>var</span><span class=p>.</span><span class=nx>managed_identities</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span><span class=p>)</span> <span class=o>&gt;</span> <span class=m>0</span><span class=p>)</span> <span class=o>?</span> <span class=p>{</span> <span class=na>this</span> = <span class=nb>var</span><span class=p>.</span><span class=nx>managed_identities</span> <span class=p>}</span> <span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>type</span>         = <span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>system_assigned</span> <span class=o>&amp;&amp;</span><span class=nb> length</span><span class=p>(</span><span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span><span class=p>)</span> <span class=o>&gt;</span> <span class=m>0</span> <span class=o>?</span> <span class=s2>&#34;SystemAssigned, UserAssigned&#34;</span> <span class=o>:</span><span class=nb> length</span><span class=p>(</span><span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span><span class=p>)</span> <span class=o>&gt;</span> <span class=m>0</span> <span class=o>?</span> <span class=s2>&#34;UserAssigned&#34;</span> <span class=o>:</span> <span class=s2>&#34;SystemAssigned&#34;</span>
</span></span><span class=line><span class=cl>      <span class=na>identity_ids</span> = <span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>The <a class=link href=https://azure.github.io/Azure-Verified-Modules/specs/shared/interfaces/#managed-identities target=_blank rel=noopener>Terraform variable declaration in the specification</a> has examples for other scenarios (e.g. SystemAssigned only, or UserAssigned only).</p><h3 id=newres-updates-for-variablestf>newres updates for variables.tf</h3><p>Edit the contents of newres\variables.tf to remove the following variables:</p><ul><li>location</li><li>name</li><li>resource_group_name</li><li>identity</li><li>tags</li></ul><p>(we&rsquo;re going to use the ones in the template, instead).</p><p>Copy the remaining variables to the top of <code>variables.tf</code> file in the module root folder.
(in our case, there is only a &rsquo;timeouts&rsquo; variable remaining).</p><h3 id=newres-tidy-up>newres tidy-up</h3><p>Remove the newres folder. By this point, any intellisense errors should be fixed in <code>main.tf</code>, and the top of the main.tf should look something like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>data</span> <span class=s2>&#34;azurerm_resource_group&#34;</span> <span class=s2>&#34;parent&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>count</span> = <span class=nb>var</span><span class=p>.</span><span class=na>location</span> =<span class=o>=</span> <span class=nx>null</span> <span class=o>?</span> <span class=m>1</span> <span class=o>:</span> <span class=m>0</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>  = <span class=nb>var</span><span class=p>.</span><span class=nx>resource_group_name</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;azurerm_dev_center&#34;</span> <span class=s2>&#34;this&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>location</span>            =<span class=nb> coalesce</span><span class=p>(</span><span class=nb>var</span><span class=p>.</span><span class=nx>location</span><span class=p>,</span> <span class=nx>local</span><span class=p>.</span><span class=nx>resource_group_location</span><span class=p>)</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>                = <span class=nb>var</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=cl>  <span class=na>resource_group_name</span> = <span class=nb>var</span><span class=p>.</span><span class=nx>resource_group_name</span>
</span></span><span class=line><span class=cl>  <span class=na>tags</span>                = <span class=nb>var</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>dynamic</span> <span class=s2>&#34;identity&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>for_each</span> = <span class=p>(</span><span class=nb>var</span><span class=p>.</span><span class=nx>managed_identities</span><span class=p>.</span><span class=nx>system_assigned</span> <span class=o>||</span><span class=nb> length</span><span class=p>(</span><span class=nb>var</span><span class=p>.</span><span class=nx>managed_identities</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span><span class=p>)</span> <span class=o>&gt;</span> <span class=m>0</span><span class=p>)</span> <span class=o>?</span> <span class=p>{</span> <span class=na>this</span> = <span class=nb>var</span><span class=p>.</span><span class=nx>managed_identities</span> <span class=p>}</span> <span class=o>:</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>type</span>         = <span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>system_assigned</span> <span class=o>&amp;&amp;</span><span class=nb> length</span><span class=p>(</span><span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span><span class=p>)</span> <span class=o>&gt;</span> <span class=m>0</span> <span class=o>?</span> <span class=s2>&#34;SystemAssigned, UserAssigned&#34;</span> <span class=o>:</span><span class=nb> length</span><span class=p>(</span><span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span><span class=p>)</span> <span class=o>&gt;</span> <span class=m>0</span> <span class=o>?</span> <span class=s2>&#34;UserAssigned&#34;</span> <span class=o>:</span> <span class=s2>&#34;SystemAssigned&#34;</span>
</span></span><span class=line><span class=cl>      <span class=na>identity_ids</span> = <span class=nx>identity</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>user_assigned_resource_ids</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nx>dynamic</span> <span class=s2>&#34;timeouts&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>for_each</span> = <span class=nb>var</span><span class=p>.</span><span class=na>timeouts</span> =<span class=o>=</span> <span class=nx>null</span> <span class=o>?</span> <span class=p>[]</span> <span class=o>:</span> <span class=p>[</span><span class=nb>var</span><span class=p>.</span><span class=nx>timeouts</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=nx>content</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>create</span> = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>create</span>
</span></span><span class=line><span class=cl>      <span class=na>delete</span> = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>delete</span>
</span></span><span class=line><span class=cl>      <span class=na>read</span>   = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>read</span>
</span></span><span class=line><span class=cl>      <span class=na>update</span> = <span class=nx>timeouts</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>update</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1># required AVM interfaces
</span></span></span><span class=line><span class=cl><span class=c1># (etc)
</span></span></span></code></pre></td></tr></table></div></div><h2 id=todo-hunting>TODO hunting</h2><p>There are a few &ldquo;TODO&rdquo; references in the files that need to be fixed and removed, ignore any that are in &ldquo;README.md&rdquo; because we&rsquo;ll fix those when we automatically update the docs.</p><h3 id=maintf>main.tf</h3><ul><li>update <code>azurerm_TODO_resource</code> appropriately, e.g. <code>azurerm_dev_center</code>.</li></ul><h3 id=localstelemetrytf>locals.telemetry.tf</h3><ul><li>set the module name and leave the module_type as &ldquo;res&rdquo;, e.g.:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl>  <span class=na>telem_puid</span> = <span class=s2>&#34;UNOFFICIAL&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>module_name</span> = <span class=s2>&#34;res-devcenter-devcenter&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>module_type</span> = <span class=s2>&#34;res&#34;</span>
</span></span></code></pre></td></tr></table></div></div><p>I suggest setting telem_puid to &ldquo;UNOFFICIAL&rdquo; in resources created for learning.</p><h3 id=mainprivateendpointtf>main.privateendpoint.tf</h3><ul><li>You would typically update <code>private_service_connection</code> with the correct resource id and subresource name, something like this:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=nx>private_service_connection</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>name</span>                           = <span class=nb>each</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>private_service_connection_name</span> <span class=o>!=</span> <span class=nx>null</span> <span class=o>?</span> <span class=nb>each</span><span class=p>.</span><span class=nx>value</span><span class=p>.</span><span class=nx>private_service_connection_name</span> <span class=o>:</span> <span class=s2>&#34;pse-</span><span class=si>${</span><span class=nb>var</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>private_connection_resource_id</span> = <span class=nx>azurerm_TODO</span><span class=p>.</span><span class=nx>this</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>    <span class=na>is_manual_connection</span>           = <span class=kc>false</span>
</span></span><span class=line><span class=cl>    <span class=na>subresource_names</span>              = <span class=p>[</span><span class=s2>&#34;TODO subresource name&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p><em>However</em>, in this case, Dev Center doesn&rsquo;t support private endpoints, so we&rsquo;re going to remove this file altogether.</p><p>There is a handy <a class=link href=https://learn.microsoft.com/en-us/azure/private-link/private-endpoint-overview#private-link-resource target=_blank rel=noopener>link</a> in the template that helps find the right subresource name, should you need it for your resource.</p><h3 id=localstf>locals.tf</h3><ul><li>We don&rsquo;t have any locals to add at the moment, so lets remove the reminder to &ldquo;insert locals here&rdquo;</li><li>In our example, lets also remove the private endpoint local var, as we don&rsquo;t need private endpoints.</li></ul><h3 id=terraformtf>terraform.tf</h3><ul><li>remove the reminder to add required providers</li><li>providers should really be versioned like this (a correction to template is needed to align to AVM):</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=nx>terraform</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>required_version</span> = <span class=s2>&#34;&gt;= 1.5.0&#34;</span>
</span></span><span class=line><span class=cl>  <span class=nx>required_providers</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>azurerm</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>source</span>  = <span class=s2>&#34;hashicorp/azurerm&#34;</span>
</span></span><span class=line><span class=cl>      <span class=na>version</span> = <span class=s2>&#34;&gt;= 3.71.0, &lt; 4.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=na>random</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>source</span>  = <span class=s2>&#34;hashicorp/random&#34;</span>
</span></span><span class=line><span class=cl>      <span class=na>version</span> = <span class=s2>&#34;&gt;= 3.5.0, &lt; 4.0&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=variablestf>variables.tf</h3><ul><li><p>In the <code>name</code> variable, update the regex in the validation condition. If you&rsquo;re not sure how to do this, remove the validation block for now and we will return to it later.</p></li><li><p>Since our resource doesn&rsquo;t support private endpoints, remove the &ldquo;private_endpoints&rdquo; variable.</p></li><li><p>For an unofficial module, you might want to consider setting the default value of the <code>enable_telemetry</code> variable to <code>false</code>.</p></li></ul><h3 id=outputstf>outputs.tf</h3><ul><li>In this case, we don&rsquo;t need the output <code>private_endpoints</code>.</li><li>Remove the reminder <code>TODO</code></li><li>Update the <code>resource</code> output value & add a couple mandatory outputs missing from the template:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>output</span> <span class=s2>&#34;resource&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>value</span>       = <span class=nx>azurerm_dev_center</span><span class=p>.</span><span class=nx>this</span>
</span></span><span class=line><span class=cl>  <span class=na>description</span> = <span class=s2>&#34;This is the full output for the resource.&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>output</span> <span class=s2>&#34;id&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>description</span> = <span class=s2>&#34;The ID of the resource.&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>value</span>       = <span class=nx>azurerm_dev_center</span><span class=p>.</span><span class=nx>this</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>output</span> <span class=s2>&#34;name&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>description</span> = <span class=s2>&#34;The name of the resource&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>value</span>       = <span class=nx>azurerm_dev_center</span><span class=p>.</span><span class=nx>this</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=_headermd>_header.md</h3><ul><li>If you&rsquo;re using this for learning, remove the contents of this file and replace with something like this:</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=c1># terraform-azurerm-res-devcenter-devcenter
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=nx>This</span> <span class=nx>is</span> <span class=nx>a</span> <span class=nx>Terraform</span> <span class=nb>module</span> <span class=k>for</span> <span class=nx>Azure</span> <span class=nx>Dev</span> <span class=nx>Center</span> <span class=k>in</span> <span class=nx>the</span> <span class=nx>style</span> <span class=nx>of</span> <span class=nx>Azure</span> <span class=nx>Verified</span> <span class=nx>Modules</span><span class=p>.</span>  <span class=nx>For</span> <span class=nx>official</span> <span class=nb>module</span><span class=nx>s</span> <span class=nx>please</span> <span class=nx>see</span> <span class=o>&lt;</span><span class=nx>https</span><span class=o>:</span><span class=c1>//aka.ms/AVM&gt;.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=p>[</span><span class=o>!</span><span class=nx>WARNING</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=o>&gt;</span> <span class=nx>Major</span> <span class=nx>version</span> <span class=nx>Zero</span> <span class=p>(</span><span class=m>0</span><span class=p>.</span><span class=nx>y</span><span class=p>.</span><span class=nx>z</span><span class=p>)</span> <span class=nx>is</span> <span class=k>for</span> <span class=nx>initial</span> <span class=nx>development</span><span class=p>.</span> <span class=nx>Anything</span> <span class=nx>MAY</span> <span class=nx>change</span> <span class=nx>at</span> <span class=nx>any</span> <span class=nx>time</span><span class=p>.</span> <span class=nx>A</span> <span class=nb>module</span> <span class=nx>SHOULD</span> <span class=nx>NOT</span> <span class=nx>be</span> <span class=nx>considered</span> <span class=nx>stable</span> <span class=nx>till</span> <span class=nx>at</span> <span class=nx>least</span> <span class=nx>it</span> <span class=nx>is</span> <span class=nx>major</span> <span class=nx>version</span> <span class=nx>one</span> <span class=p>(</span><span class=m>1</span><span class=p>.</span><span class=m>0</span><span class=p>.</span><span class=m>0</span><span class=p>)</span> <span class=nx>or</span> <span class=nx>greater</span><span class=p>.</span> <span class=nx>Changes</span> <span class=nx>will</span> <span class=nx>always</span> <span class=nx>be</span> <span class=nx>via</span> <span class=nx>new</span> <span class=nx>versions</span> <span class=nx>being</span> <span class=nx>published</span> <span class=nx>and</span> <span class=nx>no</span> <span class=nx>changes</span> <span class=nx>will</span> <span class=nx>be</span> <span class=nx>made</span> <span class=nx>to</span> <span class=nx>existing</span> <span class=nx>published</span> <span class=nx>versions</span><span class=p>.</span> <span class=nx>For</span> <span class=nx>more</span> <span class=nx>details</span> <span class=nx>please</span> <span class=nx>go</span> <span class=nx>to</span> <span class=o>&lt;</span><span class=nx>https</span><span class=o>:</span><span class=c1>//semver.org/&gt;
</span></span></span></code></pre></td></tr></table></div></div><p>If this is not an official module, then I suggest removing the following files:</p><ul><li><code>SUPPORT.MD</code></li><li><code>SECURITY.MD</code></li><li><code>.github\CODEOWNERS</code></li></ul><h2 id=creating-the-default-example>Creating the default example</h2><p>Each of the subfolders inside <code>.\examples</code> contain a test that is run as part of the end-to-end tests during the the pull request workflow.</p><p>AVM modules start with a &ldquo;default&rdquo; example - the purpose of this is to test the module in its simplest form with the minimum number of parameters.</p><h3 id=update-the-default-example>Update the default example</h3><p>In the default example, you may need to modify the resource group logic if you have policy that restricts where you can deploy resources:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;azurerm_resource_group&#34;</span> <span class=s2>&#34;this&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>     = <span class=nb>module</span><span class=p>.</span><span class=nx>naming</span><span class=p>.</span><span class=nx>resource_group</span><span class=p>.</span><span class=nx>name_unique</span>
</span></span><span class=line><span class=cl>  <span class=na>location</span> = <span class=s2>&#34;AustraliaEast&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>In this case, the resource is only supported in the following regions, so pick one of these:</p><ul><li>&lsquo;australiaeast,canadacentral,westeurope,japaneast,uksouth,eastus,eastus2,southcentralus,westus3,centralindia,eastasia,northeurope,koreacentral&rsquo;</li></ul><p>This also means we can remove the logic that randomly selects a region:</p><p><img src=/p/2024/02/write-an-avm-module/remove-random-region.png width=531 height=416 srcset="/p/2024/02/write-an-avm-module/remove-random-region_huf92d07ef5771d8ed5f1b3250f72d543d_20186_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/remove-random-region_huf92d07ef5771d8ed5f1b3250f72d543d_20186_1024x0_resize_box_3.png 1024w" loading=lazy alt="lines to be removed" class=gallery-image data-flex-grow=127 data-flex-basis=306px></p><p>The module call is at the end of <code>main.tf</code>, this would typically need adjustment to add the required variables, however in the case of Dev Center, just the name and resource group is enough:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=c1># This is the module call
</span></span></span><span class=line><span class=cl><span class=c1># Do not specify location here due to the randomization above.
</span></span></span><span class=line><span class=cl><span class=c1># Leaving location as `null` will cause the module to use the resource group location
</span></span></span><span class=line><span class=cl><span class=c1># with a data source.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kr>module</span> <span class=s2>&#34;dev_center&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>source</span> = <span class=s2>&#34;../../&#34;</span><span class=c1>
</span></span></span><span class=line><span class=cl><span class=c1>  # source             = &#34;Azure/avm-res-devcenter-devcenter/azurerm&#34;
</span></span></span><span class=line><span class=cl><span class=c1>  # ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>enable_telemetry</span>    = <span class=nb>var</span><span class=p>.</span><span class=nx>enable_telemetry</span><span class=c1> # see variables.tf
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=na>name</span>                = <span class=nb>module</span><span class=p>.</span><span class=nx>naming</span><span class=p>.</span><span class=nx>dev_test_lab</span><span class=p>.</span><span class=nx>name_unique</span>
</span></span><span class=line><span class=cl>  <span class=na>resource_group_name</span> = <span class=nx>azurerm_resource_group</span><span class=p>.</span><span class=nx>this</span><span class=p>.</span><span class=nx>name</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=updating-docs-and-running-pr-checks>Updating docs and running PR checks</h2><p>This requires Docker to be installed as the checks run in a container (The Codespace is set up with Docker support).</p><p>The AVM template includes a script to help running checks. There is a bash version (<code>./avm</code>) and a batch file version (<code>./avm.bat</code>). I recommend using the <strong>bash</strong> version.</p><p>Don&rsquo;t forget to check the line-encoding is set to &ldquo;LF&rdquo;, else you will get <code>/usr/bin/env: ‘sh\r’: No such file or directory</code>.</p><p>Mark the file as executable the first time you use the script:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chmod +x ./avm
</span></span></code></pre></td></tr></table></div></div><p>To update the docs:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./avm docs
</span></span></code></pre></td></tr></table></div></div><p>Once the container has been pulled, you&rsquo;ll see output like this:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-text data-lang=text><span class=line><span class=cl>curl -H &#39;Cache-Control: no-cache, no-store&#39; -sSL &#34;&#34;https://raw.githubusercontent.com/Azure/tfmod-scaffold/main/avm_scripts&#34;/docs-gen.sh&#34; | sh -s
</span></span><span class=line><span class=cl>==&gt; Generating module documentation...
</span></span><span class=line><span class=cl>README.md updated successfully
</span></span><span class=line><span class=cl>==&gt; Generating examples documentation...
</span></span><span class=line><span class=cl>===&gt; Generating examples documentation in ./default
</span></span><span class=line><span class=cl>default/README.md updated successfully
</span></span></code></pre></td></tr></table></div></div><p>To confirm readiness for a Pull Request, run the following:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>./avm pr-check
</span></span></code></pre></td></tr></table></div></div><p>At the time of writing, this will perform the following:</p><ul><li>ensure each of the examples <code>terraform validate</code></li><li>run formatting and lint checks for go and terraform</li><li>run any unit tests (not the end to end examples - they run during PR)</li></ul><h2 id=github-runners>GitHub runners</h2><p>Microsoft use internal runners for AVM end to end tests. If you&rsquo;re not a Microsoft FTE, you&rsquo;ll need to amend your E2E tests to use your own subscription</p><p>To do this, replace <code>.github\workflows\e2e.yml</code> with my version here:</p><p><a class=link href=https://gist.github.com/kewalaka/93ec3da3c6a39610da3eef4b04c37365 target=_blank rel=noopener>https://gist.github.com/kewalaka/93ec3da3c6a39610da3eef4b04c37365</a></p><p>Note, running end to end tests deploys and destroys resources, thus does incur cost.</p><h2 id=raise-a-pr>Raise a PR</h2><p>If you&rsquo;ve made it this far, and resolved any PR checks, you are ready to raise the initial pull request.</p><p>If you&rsquo;ve been following along, hopefully success will smile down on you:</p><p><img src=/p/2024/02/write-an-avm-module/all-checks-passed.png width=851 height=308 srcset="/p/2024/02/write-an-avm-module/all-checks-passed_hu84f8dfe1533e20247501f296d52a206d_23234_480x0_resize_box_3.png 480w, /p/2024/02/write-an-avm-module/all-checks-passed_hu84f8dfe1533e20247501f296d52a206d_23234_1024x0_resize_box_3.png 1024w" loading=lazy alt="all checks have passed in the PR" class=gallery-image data-flex-grow=276 data-flex-basis=663px></p><p>&mldr; at which your point can merge to main and congratulate yourself on getting this far!</p><h3 id=find-this-on-github>Find this on Github</h3><p>You can find the result of this blog post at this location:</p><p><a class=link href=https://github.com/kewalaka/terraform-azurerm-avm-res-devcenter-devcenter target=_blank rel=noopener>https://github.com/kewalaka/terraform-azurerm-avm-res-devcenter-devcenter</a></p><h2 id=where-next>Where next</h2><p>There&rsquo;s more to follow in future blog posts, here&rsquo;s a taster:</p><h3 id=add-child-resources>Add child resources</h3><p>The scope of an AVM module must include &ldquo;child&rdquo; resources within the same resource provider scope, <a class=link href=https://learn.microsoft.com/en-us/azure/templates/microsoft.devcenter/devcenters target=_blank rel=noopener>which for Dev Centre is here</a>.</p><p>In the case of Dev Center, this means the module needs to be extended to include dev center projects. Other child resource such as DevBox definitions and Gallery support will require use of the AzAPI provider, as they are not yet covered by AzureRM.</p><h3 id=add-more-examples-end-to-end-tests>Add more examples (end to end tests)</h3><p>Tests need to be added to provide coverage for resource functionality. See <code>.\examples\README.md</code> for more info on how to add new examples.</p><h2 id=where-to-look-for-inspiration>Where to look for inspiration</h2><p>Matt White (<a class=link href=github.com/matt-FFFFFF>@matt-FFFFFF</a> on Github) is the Microsoft lead for Azure Verified Modules, if you&rsquo;re looking for inspiration then I recommend checking out his Key Vault module here:</p><p><a class=link href=https://github.com/Azure/terraform-azurerm-avm-res-keyvault-vault target=_blank rel=noopener>https://github.com/Azure/terraform-azurerm-avm-res-keyvault-vault</a></p><p>You can also check out some of my own AVM-style modules, e.g. these ones in the Azure org that I have helped co-author:</p><ul><li><a class=link href=https://github.com/Azure/terraform-azurerm-avm-res-containerregistry-registry target=_blank rel=noopener>https://github.com/Azure/terraform-azurerm-avm-res-containerregistry-registry</a></li><li><a class=link href=https://github.com/Azure/terraform-azurerm-avm-res-app-managedenvironment target=_blank rel=noopener>https://github.com/Azure/terraform-azurerm-avm-res-app-managedenvironment</a></li><li><a class=link href=https://github.com/Azure/terraform-azurerm-avm-res-eventhub-namespace target=_blank rel=noopener>https://github.com/Azure/terraform-azurerm-avm-res-eventhub-namespace</a></li></ul><p>& you can find more on <a class=link href=https://github.com/kewalaka target=_blank rel=noopener>my GitHub account</a>, that I&rsquo;m in the progress of contributing:</p><ul><li><a class=link href=https://github.com/kewalaka/terraform-azurerm-avm-res-sql-server target=_blank rel=noopener>https://github.com/kewalaka/terraform-azurerm-avm-res-sql-server</a></li><li><a class=link href=https://github.com/kewalaka/terraform-azurerm-avm-res-cognitiveservices-account target=_blank rel=noopener>https://github.com/kewalaka/terraform-azurerm-avm-res-cognitiveservices-account</a></li><li><a class=link href=https://github.com/kewalaka/terraform-azurerm-res-storage-storageaccount target=_blank rel=noopener>https://github.com/kewalaka/terraform-azurerm-res-storage-storageaccount</a></li></ul><p>Below is an &ldquo;AVM-style&rdquo; Container Apps that uses an AzureRM-like interface, whilst using AzAPI internally:</p><ul><li><a class=link href=https://github.com/kewalaka/terraform-azapi-res-app-containerapp target=_blank rel=noopener>https://github.com/kewalaka/terraform-azapi-res-app-containerapp</a></li></ul></section><footer class=article-footer><section class=article-tags><a href=/tags/terraform/>terraform</a>
<a href=/tags/avm/>avm</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0, unless noted by credits.</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/2024/02/avm-resource-interfaces/><div class=article-image><img src=/p/2024/02/avm-resource-interfaces/i_am_your_parent.d1f8166b874f5af5639dfbcc1f06fb70_huc23435601578979f25568bab33f71934_24123_250x150_fill_box_smart1_3.png width=250 height=150 loading=lazy alt="Featured image of post AVM module interfaces & their children" data-key=2024/02/avm-resource-interfaces data-hash="md5-0fgWa4dPWvVjnfvMHwb7cA=="></div><div class=article-details><h2 class=article-title>AVM module interfaces & their children</h2></div></a></article><article class=has-image><a href=/p/2023/09/azure-verified-modules/><div class=article-image><img src=/p/2023/09/azure-verified-modules/avm.3e6891a620edf4f67590a3c746bd8a2c_hue3b3e79cae567de3ff62a3d95e3d5aa2_17051_250x150_fill_q75_box_smart1.jpg width=250 height=150 loading=lazy alt="Featured image of post Azure Verified Modules" data-key=2023/09/azure-verified-modules data-hash="md5-PmiRpiDt9PZ1kKPHRr2KLA=="></div><div class=article-details><h2 class=article-title>Azure Verified Modules</h2></div></a></article></div></div></aside><div id=cusdis_thread data-host=https://cusdis.com data-app-id=79052d37-f39f-4b03-b115-5e3b853c09cd data-page-id=b1dff69408144b38031935de8a7c9bce data-page-url=https://blog.kewalaka.nz/p/2024/02/write-an-avm-module/ data-page-title="How to write your first AVM resource module"></div><script async defer src=https://cusdis.com/js/cusdis.es.js></script><script>function setCusdisTheme(e){let t=document.querySelector("#cusdis_thread iframe");t&&window.CUSDIS.setTheme(e)}window.addEventListener("onColorSchemeChange",e=>{setCusdisTheme(e.detail)})</script><footer class=site-footer><section class=copyright>&copy;
2023 -
2024 The blog of Kewalaka</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.21.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>